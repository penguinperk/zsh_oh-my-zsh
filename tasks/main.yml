---
- name: Printing the environmentâ€‹ variable in Ansible
  debug:
    msg: "{{ lookup('env','USER') }}"
  register: username

- name: clone oh-my-zsh
  git: repo=https://github.com/robbyrussell/oh-my-zsh.git
       dest=~/.oh-my-zsh
       update=no

- name: check if .zshrc exists
  stat: path=~/.zshrc
  register: zshrc

#- name: back up existing .zshrc file if it exists
#  copy: src=~/.zshrc
#        dest=~/.zshrc-orig
  #when: zshrc.stat.exists

#Run only when the has been changed 
- name: copy zshrc to user home
  copy: src=".zshrc"
        dest=~/
        force=yes
        backup=yes
  #when: zshrc.stat.exists
       

- name: Validating the current shell
  shell: echo $SHELL
  register: isSHELL

- debug: 
    msg: "The Current Shell is: {{ isSHELL.stdout }}"

- name: change user shell to zsh
  become: yes
  become_user: root
  command: chsh -s /bin/zsh "{{ lookup('env','USER') }}"
  changed_when: isSHELL.stdout.find("/bin/zsh")|bool == false